<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <base href="https://vsatresq.com/">
    <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="icon" type="image/png" href="./favicon.ico" />
    <script src="node_modules/jquery/dist/jquery.js"></script>
    <script src="/scripts/selfserve.js"></script>
    <script src="/scripts/random_banner.js"></script>
    <script src="/scripts/logintext_handler.js"></script>
    <!--TODO: can i make this better at all? 4 scripts???-->
    <title>VSAT ResQ</title>
</head>

<body>
    <header class="jumbotron">
        <div class="container-fluid">
            <div class="row">
                <div class="logo-container align-items-center">
                    <img class="logo-img" src="/images/new_logo.png">
                </div>
                <div class="drop_shadow w-100">
                    <nav class="navbar navbar-expand-md navbar-dark bg-dark w-100">
                        <button class="navbar-toggler" type="button" data-toggle="collapse"
                            data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="navbar-nav mr-auto">
                                <li class="nav-item" id="nav-home">
                                    <a class="nav-link" href="./index.html">Home <span
                                            class="sr-only">(current)</span></a>
                                </li>
                                <li class="nav-item" id="nav-blog">
                                    <a class="nav-link" href="./blog">Blog</a>
                                </li>
                                <li class="nav-item" id="nav-pastjobs"><a class="nav-link"
                                        href="./PastJobs.html">Jobs</a></li>
                                <li class="nav-item" id="nav-about"><a class="nav-link" href="./AboutUs.html">About</a>
                                </li>
                                <li class="nav-item dropdown ">
                                    <!--.disabled-->
                                    <a class="nav-link dropdown-toggle" id="login-text" role="button"
                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        Login
                                    </a>
                                    <!--TODO: fix all these links and make them non-relative. -->
                                    <div class="dropdown-menu" aria-labelledby="login-text">
                                        <a class="dropdown-item authorized-only" id="nav-ucp" href="./blog/ucp">User
                                            Settings</a>
                                        <a class="dropdown-item authorized-only" id="nav-inventory" href="/inventory">Inventory (Beta)</a>
                                        <div class="dropdown-divider authorized-only"></div>
                                        <a class="dropdown-item" href="./blog/login" id="nav-login">Login</a>
                                    </div>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#" id="contact-us" role="button"
                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        Contact
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="contact-us">
                                        <a class="dropdown-item" href="mailto:dispatch@vsatresq.com">Email</a>
                                        <a class="dropdown-item" href="tel:+13867471525">Phone</a>
                                        <a class="dropdown-item" href="https://www.facebook.com/VsatResQ/">Facebook</a>
                                        </a>
                                </li>
                            </ul>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <div class="container h-100" id='fluidify-me'>
        <div class="row h-100 align-items-center">
            <div id="maincontentarea" class="main_content_area h-100">
                <style>
    #login_form {
        display: block;
    }
</style>

<script>
    document.title = "Login - VSAT ResQ";

    // On a successful login, hide the form and show a success message.
    const loginSuccessful = () => {
        $("#login_form").hide();
        $("#login_success_container").show();

        $(".login_success_message").html(`Successfully logged in as <b>${selfserve.global.currentUser.username}</b>`);
    };

    const formSubmitClick = () => {
        const _username = $("#username_textbox").val();
        const _password = $("#password_textbox").val();
        let _remember = $("#remember_checkbox").val();
        _remember = (_remember === "on");

        console.log(_username, _password, _remember);
        selfserve.auth.loginAs(_username, _password, _remember, (result) => {

            console.log("Result and status of login req: ");
            console.log(result);

            if (result.status === "success") {
                console.log(`You have been successfully logged in, ${result.result.username}`);
                alert(`You have been successfully logged in, ${result.result.username}`);
                location.assign('./');
            }
            else {
                alert('Error while logging in:\n\n' + JSON.stringify(result));
            }
        });
    };

    selfserve.auth.handleLoginExternally = true;
    selfserve.auth.onLogin.push(() => {
        if (selfserve.global.loggedIn) {
            loginSuccessful();
        }
    });

    const doLogout = () => {
        selfserve.auth.logout(() => {
            alert("You have been logged out.");
            window.location.reload();
        });
    };

    selfserve.global.onLoad.push(() => selfserve.random_banner.setBannerWithGradient("./images/random/constellation_entity.jpg", { r: 255, g: 255, b: 255 }));

</script>

<div id="login_container" style="padding: 1%;">
    <div id="login_success_container" style="display: none;">
        <div class="login_success_message"></div>
        <input type="button" value="Logout" onclick="doLogout();">
    </div>
    <div>
        <form id="login_form" action="javascript:formSubmitClick();">
            Username:<br>
            <input type="text" name="username" id="username_textbox"><br>
            Password:<br>
            <input type="password" name="password" id="password_textbox"><br>
            <input type="submit" value="Login"><br>
            <input type="checkbox" name="remember" id="remember_checkbox" checked>
            <label for="remember_checkbox">Remember me for 30 days</label><br>
            <a href="./blog/register">Need an account?</a>
        </form>
    </div>
</div>
            </div>
            <!--
            <div id="sidenav" class="col-2 d-none d-md-block h-100">
                <h3>Recent Blog Posts</h3>
                <script>
                    $.get( "/blog/getpost?limit=5", function( data ) {
                        var resultingPosts = JSON.parse(data);
                        resultingPosts.posts.sort(function(a, b){
                            return b.date - a.date;
                        });
                        resultingPosts.posts.forEach(element => {
                            var div = $("<div>").attr('id', 'sidenav-post');
                            var sidenav = $("#sidenav");
                            div.html(`<a href="/blog/viewpost?id=${element.id}">${element.title}</a><br>${element.author} - ${element.date}<hr>`);
                            sidenav.append(div);
                        });
                    });
                </script>
            </div>
            -->
        </div>
    </div>
    <script>
        try
        {
            if(__FLUIDIFY)
            {
                console.log('Must fluidify.');
                $("#fluidify-me").removeClass('container');
                $("#fluidify-me").addClass('container-fluid');
            }
        } catch(e) {}
    </script>

    <script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
</body>

</html>