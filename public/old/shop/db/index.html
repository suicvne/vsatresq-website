<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <base href="https://vsatresq.com/">
  <link rel="stylesheet" href="/css/shop.css">

  <!--Two essential scripts and one non-essential but still fun.-->
  <script src="node_modules/jquery/dist/jquery.js"></script>
  <script src="/scripts/selfserve.js"></script>
  <script src="/scripts/selfserve_blog.js"></script>
  <script src="/scripts/random_banner.js"></script>
  <script src="/scripts/selfserve_shop.js"></script>
</head>

<body>
  <div class="wrapper">
    <div class="header_container">
      <div class="header_logo_container"><a href="./"><img class="header_logo" src="images/logo.svg"></a></div>
      <div class="header_logo_text_container">
        <div id='header_logo_text_container' style='width=100%; height=100%'>
          <h1 class="header_logo_text">PSYCH CAT WEBSTORE</h1>
        </div>
      </div>
    </div>

    <navbar class="custom_nav">
      <a href="./shop/index.html">
        <div class="shop_home tooltip">
          <img src="./images/shop/home.png" class="cart_icon">
          <span class="tooltiptext">Shop Home</span>
        </div>
      </a>
      <br>
      <a href="./TESTING/shop/cart.html">
        <div class="cart tooltip">
          <img src="./images/shop/empty_cart.png" class="cart_icon">
          <span class="item_count">0</span>
          <span class="tooltiptext">View Cart</span>
        </div>
      </a>
      <a href="./shop/shop_cp" id="shop_cp_icon" style="display: none;">
        <div class="cart tooltip">
          <img src="./images/shop/cp.png" class="cart_icon">
          <span class="tooltiptext">Shop Control Panel</span>
        </div>
      </a>
    </navbar>

    <div class="main_content_area">
      <!--TODO: Auth-->

<script>

    selfserve.global.onLoad.push(() => {
        displayItems();
    });

    const appendShopItem = (shop_item) => {
        console.log(`appending ${shop_item.item_name}`);
        $("#shop_items tbody").first().append(
            `<tr>` +
                `<td>${shop_item.item_name}</td>` +
                `<td>\$${shop_item.price} (${shop_item.currency})</td>` +
                `<td>${shop_item.description}</td>` +
                `<td>${shop_item.images}</td>` +
            `</tr>`
        );
    };

    const clearTable = () => {
        $("#shop_items tbody").first().empty().append("<tr>" +
                "<th>Item</th>" +
                "<th>Price</th>" +
                "<th>Description</th>" +
                "<th>Image URLS</th>" +
            "</tr>");
    };

    // This script
    const displayItems = () => {
        console.log("Populating table");
        clearTable();
        selfserve.shop.getAllItems((result, status) => {
            if (status === "success") {
                console.log(result);
                if (selfserve.shop.isTestMode) {
                    $("#shop_items tbody").first().append(
                        `<tr>` +
                            `<td>WARNING</td>` +
                            `<td>These are just example items.</td>` +
                            `<td>The changes you make will not actually be reflected.</td>` +
                            `<td>Have fun :)</td>` +
                        `</tr>`
                    );
                    $("#shop_items tbody").first().append(
                        `<tr>` + `<hr></hr>` +
                            /*`<td> </td>` +
                            `<td> </td>` +
                            `<td> </td>` +
                            `<td> </td>` +*/
                        `</tr>`
                    );

                }
                result.forEach(element => {
                    appendShopItem(element);
                });
            }
            else
            {
                $("#shop_items tbody").first().append(
                        `<tr>` +
                            `<td>ERROR</td>` +
                            `<td>Something bad happened.</td>` +
                            `<td>Tell Mike asap.</td>` +
                            `<td></td>` +
                        `</tr>`
                    );
            }
        });
    };

</script>

<table id="shop_items" style="width:100%">
    <tbody>
            <tr>
                    <th>Item</th>
                    <th>Price</th>
                    <th>Description</th>
                    <th>Image URLS</th>
                </tr>
    </tbody>
</table>
    </div>
  </div>
</body>

<script>
  selfserve.global.onLoad.push(() => {
    console.log('Set banner');
    selfserve.random_banner.setBannerWithGradient("./images/random/shop.png", {r: 255, g: 255, b: 255})
  });
  selfserve.auth.onLogin.push(() => 
  {
    console.log(selfserve.global.currentUser);
    if(selfserve.global.currentUser !== undefined && selfserve.global.currentUser.power === 1)
      $("#shop_cp_icon").show();
  });
</script>

</html>
