<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <base href="https://vsatresq.com/"><!--TODO: change this or make it a variable?-->
  <link rel="stylesheet" href="/css/new_main.css">

  <!--Two essential scripts and one non-essential but still fun.-->
  <script src="node_modules/jquery/dist/jquery.js"></script>
  <script src="/scripts/selfserve.js"></script>
  <script src="/scripts/random_banner.js"></script>
  <script src="/scripts/logintext_handler.js"></script> <!--TODO: can i make this better at all? 4 scripts???-->
</head>

<body>
  <div class="wrapper">
    <div class="header_container">
      <div class="selfserve_login_text"><a href="./blog/ucp/">Hide this when not logged in</a></div>
      <div class="header_logo_container"><a href="./"><img class="header_logo" src="images/logo.svg"></a></div>
      <div class="header_logo_text_container"><h1 class="header_logo_text">PSYCH CAT</h1></div>
    </div>

    <navbar class="custom_nav">
      <a href="./bio">Bio</a>
      <a href="./blog">Updates</a>
      <a href="./shop">Shop</a>
      <div class="dropdown">
          <a class="droptoggle" href="#">Gallery</a>
          <div class="dropdown-content">
            <a href="./gallery/past">Past Events</a>
            <a href="./gallery/artists">Artists</a>
            <a href="./gallery/musicians">Musicians</a>
          </div>
      </div>
      <!--<a href="./music">Music</a>-->
      <!--<a href="./shop">Shop</a>-->
      <div class="dropdown">
          <a class="droptoggle" href="#">Contact</a>
          <div class="dropdown-content">
            <a href="https://instagram.com/psych.cat/">Instagram</a>
            <a href="https://www.facebook.com/psychcat/">Facebook</a>
            <a href="mailto:psychcat666@gmail.com">Email</a>
          </div>
      </div>

      <div id="current_user_message" class="right-align">
        <a href="./auth/ucp"><img src='/images/user.png' style='max-width: 60%; height: auto;'></a>
      </div>
    </navbar>

    <div class="main_content_area">
      <!-- TODO: lots.... -->
<!--Load these first-->
<script src="https://cdn.ckeditor.com/4.10.1/standard/ckeditor.js"></script>
<script src='/scripts/selfserve_blog.js'></script>

<script>
    document.title = "Compose - Psych Cat"
    
    selfserve.global.onLoad.push(() => {
        
    });

    selfserve.auth.onLogin.push(() => {
        console.log('on login called');
        $("#login-message").hide();
        $("#edit-area").show();

        selfserve.compose.init();
    });

    selfserve.compose.initCompleteFn = () => {
        if(selfserve.compose.editModeEnabled && (selfserve.global.currentUser !== undefined))
        {
            $("#editing_message").show();
        }
    };

    const doSubmit = () => {
        selfserve.compose.submitButtonClick((status, result) => {
            if(status === "success")
            {
                alert('Result: ' + JSON.stringify(result));

                window.location.replace(`/blog/viewpost.html?id=${result._id}`);
            }
            else alert('Result: ' + JSON.stringify(result));
        });
    };

    selfserve.global.onLoad.push(() => selfserve.random_banner.setBannerWithGradient("/images/random/constellation_entity.jpg", { r: 255, g: 255, b: 255 }));
</script>

<div id="editorcontainer" class="h-100 w-100" style="padding: 1%;">
    <div id="login-message">
        <span>You must <a href="./auth/login.html">login</a> to access this.</span>
    </div>
    <div id="editing_message" style="display: none;">
        <h4>Warning</h4>
        <p>You're currently editing an already existing post.</p>
    </div>
    <div id="edit-area" class="authorized-only-hide" style="display: none;">
        <input style='width: 100%' type="text" id="ss_title" placeholder="Give your post a creative title."><br>
        <textarea name='editor' class="editor" id="ss_editor"></textarea>
        <hr>
        <button type="button" id='ss_preview_button' class="authorized-only-hide" onclick="selfserve.compose.previewButtonClick()">Preview</button> <button id='ss_submit_button' class="authorized-only-hide" onclick="doSubmit()" type="button">Submit</button>
    </div>
</div>
    </div>
  </div>
</body>

</html>
