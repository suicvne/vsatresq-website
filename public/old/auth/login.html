<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <base href="https://vsatresq.com/"><!--TODO: change this or make it a variable?-->
  <link rel="stylesheet" href="/css/new_main.css">

  <!--Two essential scripts and one non-essential but still fun.-->
  <script src="node_modules/jquery/dist/jquery.js"></script>
  <script src="/scripts/selfserve.js"></script>
  <script src="/scripts/random_banner.js"></script>
  <script src="/scripts/logintext_handler.js"></script> <!--TODO: can i make this better at all? 4 scripts???-->
</head>

<body>
  <div class="wrapper">
    <div class="header_container">
      <div class="selfserve_login_text"><a href="./blog/ucp/">Hide this when not logged in</a></div>
      <div class="header_logo_container"><a href="./"><img class="header_logo" src="images/logo.svg"></a></div>
      <div class="header_logo_text_container"><h1 class="header_logo_text">PSYCH CAT</h1></div>
    </div>

    <navbar class="custom_nav">
      <a href="./bio">Bio</a>
      <a href="./blog">Updates</a>
      <a href="./shop">Shop</a>
      <div class="dropdown">
          <a class="droptoggle" href="#">Gallery</a>
          <div class="dropdown-content">
            <a href="./gallery/past">Past Events</a>
            <a href="./gallery/artists">Artists</a>
            <a href="./gallery/musicians">Musicians</a>
          </div>
      </div>
      <!--<a href="./music">Music</a>-->
      <!--<a href="./shop">Shop</a>-->
      <div class="dropdown">
          <a class="droptoggle" href="#">Contact</a>
          <div class="dropdown-content">
            <a href="https://instagram.com/psych.cat/">Instagram</a>
            <a href="https://www.facebook.com/psychcat/">Facebook</a>
            <a href="mailto:psychcat666@gmail.com">Email</a>
          </div>
      </div>

      <div id="current_user_message" class="right-align">
        <a href="./auth/ucp"><img src='/images/user.png' style='max-width: 60%; height: auto;'></a>
      </div>
    </navbar>

    <div class="main_content_area">
      <style>
    #login_form {
        display: block;
    }
</style>

<script>
    document.title = "Login - Psych Cat";

    // On a successful login, hide the form and show a success message.
    const loginSuccessful = () => {
        $("#login_form").hide();
        $("#login_success_container").show();

        $(".login_success_message").html(`Successfully logged in as <b>${selfserve.global.currentUser.username}</b>`);
    };

    const formSubmitClick = () => {
        const _username = $("#username_textbox").val();
        const _password = $("#password_textbox").val();
        let _remember = $("#remember_checkbox").val();
        _remember = (_remember === "on");

        console.log(_username, _password, _remember);
        selfserve.auth.loginAs(_username, _password, _remember, (result) => {

            console.log("Result and status of login req: ");
            console.log(result);

            if (result.status === "success") {
                console.log(`You have been successfully logged in, ${result.result.username}`);
                alert(`You have been successfully logged in, ${result.result.username}`);
                location.assign('./');
            }
            else {
                alert('Error while logging in:\n\n' + JSON.stringify(result));
            }
        });
    };

    selfserve.auth.handleLoginExternally = true;
    selfserve.auth.onLogin.push(() => {
        if (selfserve.global.loggedIn) {
            loginSuccessful();
        }
    });

    const doLogout = () => {
        selfserve.auth.logout(() => {
            alert("You have been logged out.");
            window.location.reload();
        });
    };

    selfserve.global.onLoad.push(() => selfserve.random_banner.setBannerWithGradient("./images/random/constellation_entity.jpg", { r: 255, g: 255, b: 255 }));

</script>

<div id="login_container" style="padding: 1%;">
    <div id="login_success_container" style="display: none;">
        <div class="login_success_message"></div>
        <input type="button" value="Logout" onclick="doLogout();">
    </div>
    <div>
        <form id="login_form" action="javascript:formSubmitClick();">
            Username:<br>
            <input type="text" name="username" id="username_textbox"><br>
            Password:<br>
            <input type="password" name="password" id="password_textbox"><br>
            <input type="submit" value="Login">
            <input type="checkbox" name="remember" id="remember_checkbox" checked>
            <label for="remember_checkbox">Remember me for 30 days</label><br>
            <a href="./auth/register.html">Need an account?</a>
        </form>
    </div>
</div>
    </div>
  </div>
</body>

</html>
